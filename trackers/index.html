<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>trackers — termsattached.net</title>
  <meta name="robots" content="noindex"/>
  <style>
    :root{
      --bg:#ffffff; --fg:#111; --muted:#666; --line:#eaeaea; --maxw:860px; --pad:20px; --lh:1.55;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);line-height:var(--lh);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}
    a{color:inherit}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 var(--pad)}
    header{padding:14px 0;border-bottom:1px solid var(--line)}
    h1{font-size: clamp(20px, 3.5vw, 28px);margin:0}
    main{padding:24px 0}
    .card{border:1px solid var(--line);border-radius:6px;padding:16px;margin:16px 0}
    .muted{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:600px){.grid{grid-template-columns:1fr}}
    code, pre{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  </style>
</head>
<body>
  <header class="wrap">
    <h1>trackers</h1>
    <div class="muted">Visitors: logged. Silence: logged.</div>
  </header>

  <main class="wrap">
    <section class="grid">
      <div class="card">
        <strong>Total visits:</strong>
        <div id="visits">–</div>
      </div>
      <div class="card">
        <strong>Total silences:</strong>
        <div id="silences">–</div>
      </div>
    </section>

    <section class="card">
      <strong>What’s counted here?</strong>
      <p class="muted">
        This public page shows aggregate counts derived from a JSON log. On static hosting, the log is updated manually or by a serverless job.
        Silent visits are those with no “read terms” engagement event detected.
      </p>
    </section>

    <section class="card">
      <strong>Log schema (serverless-compatible)</strong>
      <pre><code>{
  "salt_hint": "rotate regularly",
  "events": [
    {
      "ts": "2025-08-08T00:00:00Z",
      "event": "visit|read_terms",
      "ua": "User-Agent string",
      "ref": "Referrer or null",
      "ip_hash": "sha256(ip + salt)"
    }
  ]
}</code></pre>
    </section>

    <p class="muted">© 2025 termsattached.net — protest as protocol.</p>
  </main>

  <script>
    async function loadCounts(){
      const visitsEl = document.getElementById('visits');
      const silencesEl = document.getElementById('silences');
      try{
        const res = await fetch('../log.json', {cache:'no-store'});
        if(!res.ok) throw new Error('log missing');
        const data = await res.json();
        const events = Array.isArray(data.events) ? data.events : [];
        const visits = events.filter(e => e.event === 'visit').length;
        const reads  = events.filter(e => e.event === 'read_terms').length;
        const silences = Math.max(0, visits - reads);
        visitsEl.textContent = String(visits);
        silencesEl.textContent = String(silences);
      }catch(e){
        visitsEl.textContent = '0';
        silencesEl.textContent = '0';
      }
    }
    loadCounts();
  </script>
</body>
</html>
